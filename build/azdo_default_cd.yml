# <auto-generated>
#     This code was generated.
#      To turn off auto-generation set: [AzurePipelines (AutoGenerate = false)]
#      To trigger manual generation invoke: nuke --generate-configuration AzurePipelines --host AzurePipelines
# </auto-generated>

parameters:
- name: EnvironmentIdentifier
  type: string
  default: "1101"
- name: ForceWebContentDeploy
  type: boolean
  default: false

trigger: none

schedules:
- cron: "0 1 * * *"
  displayName: Nightly Deployment.
  branches:
    include:
    - trunk
  always: false
  batch: true

stages:
  - stage: ListifyCDBuild
    displayName: 'Listify.Me CD Build'
    dependsOn: [  ]

    pool:
      name: 'FarawayLand'  

    jobs:
      - job: Build
        displayName: 'Listify CD Build'
        dependsOn: [  ]
        steps:
         
          - task: CmdLine@2
            displayName: 'Run: Initialise'
            inputs:
              script: '.\src\build.cmd Initialise --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip --root .\src\'              
      
          - task: CmdLine@2
            displayName: 'Run: ArrangeStep'
            inputs:
              script: '.\src\build.cmd ArrangeStep --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip Clean MollyCheck --root .\src\'

          - task: CmdLine@2
            displayName: 'Run: ConstructStep'
            inputs:
              script: '.\src\build.cmd ConstructStep --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip MollyCheck Clean ArrangeStep --root .\src\'
      
          - task: CmdLine@2
            displayName: 'Run: ExamineStep'
            inputs:
              script: '.\src\build.cmd ExamineStep --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip MollyCheck Clean ArrangeStep ConstructStep Compile --root .\src\'
      
          - task: CmdLine@2
            displayName: 'Run: PackageStep'
            inputs:
              script: '.\src\build.cmd PackageStep --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip MollyCheck Clean ArrangeStep ConstructStep Compile --root .\src\'

          - task: CmdLine@2
            displayName: 'Run: ReleaseStep'
            inputs:
              script: '.\src\build.cmd ReleaseStep --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip MollyCheck Clean ArrangeStep ConstructStep Compile PackageStep --root .\src\'

          - task: CmdLine@2
            displayName: 'Run: TestStep'
            inputs:
              script: '.\src\build.cmd TestStep --EnvironmentId ${{ parameters.EnvironmentIdentifier }} --OverrideSkipWebContent ${{ parameters.ForceWebContentDeploy }} --skip MollyCheck Clean ArrangeStep ConstructStep Compile ReleaseStep PackageStep --root .\src\'
